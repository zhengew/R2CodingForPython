<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>批量选择修改状态</title>
</head>
<style>
    body {
        background-color: whitesmoke;
    }

    /* table表格合并边框，取消样式 */
    .student {
        border-collapse: collapse;
        border-spacing: unset;
    }

    /* thead样式 */
    .student thead th {
        font-family: '微软雅黑', '楷体', '宋体';
        font-size: 18px;
        border: 1px solid;
        width: 100px;
        text-align: center;
        font-weight: bolder;
    }

    /* tbody样式 */
    .student tbody td {
        font-family: '楷体', '宋体';
        font-size: 16px;
        border: 1px solid;
        text-align: center;
        font-weight: normal;
    }

    /*状态列*/
    tbody .status {
        border: none;
        background-color: whitesmoke;
        width: 99px;
        text-align: center;
        font-family: '楷体', '宋体';
        font-size: 14px;
    }
    /* 按钮样式 */
    #operation #selectAllBtn, #reverseBtn, #cancelBtn, #addStuBtn, #okBtn, #closeBtn {
        display: inline-block;
        width: 60px;
        height: 28px;
        text-align: center;
        line-height: 28px;
        border: 1px solid;
        background-color: lightgray;
        margin-top: 5px;
    }

    /* 删除按钮样式*/
    .deleteBtu {
        display: inline-block;
        width: 60px;
        height: 28px;
        text-align: center;
        line-height: 28px;
        border: 1px solid;
        background-color: lightgray;
        font-family: '楷体', '宋体';
        font-size: 14px;
    }
    /* hidden隐藏标签 */
    .hidden {
        display: none;
    }

    /*玩模态对话框*/
    .shadow {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 99;
        opacity: 0.3;
        background-color: mediumpurple;
    }

    /* 对话框样式 */
    .diaLog {
        z-index: 100;
        position: fixed;
        top: 40%;
        left: 40%;
        width: 320px;
        height: 162px;
        background-color: pink;
        border: 1px solid;
    }

    /* 对话框提示信息样式 */
    .diaLog .errorMsg {
        font-family: '微软雅黑', '楷体', '宋体';
        font-size: 12px;
        color: red;
        text-decoration: underline;
    }

</style>
<body>
    <form action="">
        <table class="student">
            <thead>
                <tr>
                    <th>全选</th>
                    <th>姓名</th>
                    <th>性别</th>
                    <th>年龄</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
            <tr>
                <td>
                    <input type="checkbox" class="checkAll">
                </td>
                <td>雪飞</td>
                <td>女</td>
                <td>18</td>
                <td>
                    <select name="status" class="status">
                        <option value="1">预报名</option>
                        <option value="2">已报名</option>
                        <option value="3">已缴费</option>
                    </select>
                </td>
                <td>
                    <span class="deleteBtu">删除</span>
                </td>
            </tr>
            <tr>
                <td>
                    <input type="checkbox" class="checkAll">
                </td>
                <td>于文洋</td>
                <td>男</td>
                <td>19</td>
                <td>
                    <select name="status" class="status">
                        <option value="1">预报名</option>
                        <option value="2">已报名</option>
                        <option value="3">已缴费</option>
                    </select>
                </td>
                <td>
                    <span class="deleteBtu">删除</span>
                </td>
            </tr>
            </tbody>
        </table>
    </form>
    <div id="operation">
        <span id="selectAllBtn">全选</span>
        <span id="reverseBtn">反选</span>
        <span id="cancelBtn">取消</span>
        <span id="addStuBtn">增加</span>
    </div>
</body>
<script src="../jquery.js"></script>
<script>
    // 全选按钮
    $('#operation').on('click', '#selectAllBtn', function () {
        // 设置复选框属性值 checked
        $('.student tbody .checkAll').prop('checked', true); 
    });

    // 反选按钮
    $('#operation').on('click', '#reverseBtn', function () {
        // prop 支持回掉函数，参数i未当前元素的索引值，第二个参数为当前元素的checked属性值；
        $('.student tbody .checkAll').prop('checked', function (i, val) {
            return !val;
        });
    });

    // 取消按钮
    $('#operation').on('click', '#cancelBtn', function () {
        $('.student tbody .checkAll').prop('checked', false);
    });

    // 删除按钮事件
    $('tbody').on('click', '.deleteBtu', function () {
        $(this).parent().parent().remove();
    })

    // 创建标签
    function createTag(tagName){
        return document.createElement(tagName);
    }

    // disLog对话框
    var addStuDiaLog = '<div class="addStudent diaLog">\n' +
            '        <div>\n' +
            '            <label for="username">姓名:</label>\n' +
            '            <input type="text" id="username">\n' +
            '        </div>\n' +
            '        <div>\n' +
            '            <label class="sex">性别:</label>\n' +
            '            <input type="radio" name="sex" class="sex" value="1" checked>男\n' +
            '            <input type="radio" name="sex" class="sex" value="2">女\n' +
            '        </div>\n' +
            '        <div>\n' +
            '            <label for="age">年龄:</label>\n' +
            '            <input type="text" id="age">\n' +
            '        </div>\n' +
            '        <div>' +
            '           <label for="status">状态:</label>' +
            '            <select name="status" class="status">\n' +
    '                        <option value="1">预报名</option>\n' +
    '                        <option value="2">已报名</option>\n' +
    '                        <option value="3">已缴费</option>\n' +
    '                    </select>' +
            '        </div>' +
            '        <div class="diaBtn">\n' +
            '            <span id="okBtn">确定</span>\n' +
            '            <span id="closeBtn">取消</span>\n' +
            '        </div>\n' +
            '    </div>';

    // 增加按钮
    $('#operation').on('click', '#addStuBtn', function () {
        // 玩模态对话框
        var shadowTag = createTag('div');
        $(shadowTag).addClass('shadow')
        $('body').append(shadowTag)
        // console.log(shadowTag)
        // 学生信息录入对话框
        // console.log($(addStuDiaLog).children())
        // 文档载入后调整按钮位置
        $(function () {
            $('.diaBtn').css({'margin': '10px 85px'})
        })
        $('body').append(addStuDiaLog)

    })

    // diaLog对话框确定按钮,新增student表格信息
    $('body').on('click', '#okBtn', function(){
        nameRegex = /^[^0-9].{1,19}$/g
        ageRegex = /(^[1-5][0-9]$)/g
        // 清空提示信息
        $('.diaLog').find('.errorMsg').remove()

        // 用户选中的标签值
        var usernameVal = $('.diaLog').find('#username').val();
        var sexVal = $('.diaLog').find('.sex').val() === '1' ? '男': '女';
        var ageVal = $('.diaLog').find('#age').val();
        var statusVal = $('.diaLog').find('.status').val();
        // console.log('状态:'+statusVal)

        // 判断标签是否为空
        var isNullVal = false;
        // console.log('isNullVal:' + isNullVal)
        if (usernameVal === ''){
            $('.diaLog').find('#username').after('<span class="errorMsg"> 用户名不能为空</span>')
            isNullVal = true;
        } else if (!nameRegex.test(usernameVal)){
            $('.diaLog').find('#username').after('<span class="errorMsg"> 用户名不能以数字开头,长度限制为2～20位字符</span>')
            nameRegex.lastIndex = 0;
            isNullVal = true;
        }

        if (ageVal === ''){
            $('.diaLog').find('#age').after('<span class="errorMsg"> 年龄不能为空</span>')
            isNullVal = true;
        } else if (!ageRegex.test(ageVal)){
            $('.diaLog').find('#age').after('<span class="errorMsg"> 年龄限制为10～59岁</span>');
            ageRegex.lastIndex = 0;
            isNullVal = true;
        }
        // console.log('isNullVal:' + isNullVal)
        if (!isNullVal){
            // 新增数据并插入tbody
            var checkAllTag = '<td>\n' +
                '                    <input type="checkbox" class="checkAll">\n' +
                '                </td>';
            var nameTag = '<td>'+ usernameVal +'</td>';
            var sexTag = '<td>' + sexVal + '</td>';
            var ageTag = '<td>' + ageVal + '</td>';
            var statusTag = '<td>\n' +
                '                    <select name="status" class="status">\n' +
                '                        <option value="1">预报名</option>\n' +
                '                        <option value="2">已报名</option>\n' +
                '                        <option value="3">已缴费</option>\n' +
                '                    </select>\n' +
                '                </td>';
            var deleteBtuTag = '<td>\n' +
                '                    <span class="deleteBtu">删除</span>\n' +
                '                </td>';
            var newTag = document.createElement('tr');
            $(newTag).append(checkAllTag);
            $(newTag).append(nameTag);
            $(newTag).append(sexTag);
            $(newTag).append(ageTag);
            $(newTag).append(statusTag);
            $(newTag).append(deleteBtuTag);
            $(newTag).find('.status').val(statusVal);
            // console.log($(newTag).find('.status'))
            $('body .student tbody').append(newTag);
            // 隐藏对话框和玩模态对话框
            $(function(){
                $('.diaLog').remove();
                $('.shadow').remove();
            })
        }
    })


    // 学生信息录入对话框，取消按钮事件
    $('body').on('click', '#closeBtn', function () {
        // 页面载入后删除对话框和玩模态对话框
        $(function(){
            $('.diaLog').remove();
            $('.shadow').remove();
        })
    })

    // day50 作业一
    // 按住shift键批量修改状态
    $(window).keydown(function (e) { // 键盘keydown事件
        // console.log(e.which)
        $('tbody').on('change', '.status', function () { // change事件
            var changeVal = $(this).val(); // 发生改变的下拉框 value值
            if (e.which === 16){ // shift键数值-16
                var statusOption = $('tbody .checkAll:checked').parent().parent().find('.status');
                // 循环修改下拉框value值
                for (var i = 0; i < statusOption.length; i++){
                    statusOption.eq(i).val(changeVal);
                }
            }
        })
    });




</script>
</html>